"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.js":
/*!***************************!*\
  !*** ./src/middleware.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_auth_middleware__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/middleware */ \"(middleware)/./node_modules/next-auth/middleware.js\");\n/* harmony import */ var next_auth_middleware__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_middleware__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth/jwt */ \"(middleware)/./node_modules/next-auth/jwt/index.js\");\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_auth_jwt__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/browser/jwt/verify.js\");\n/* harmony import */ var _lib_plans__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/plans */ \"(middleware)/./src/lib/plans.js\");\n// src/middleware.js\nconst runtime = \"nodejs\";\n\n\n\n\n\n// --- Feature Mappings ---\nconst PATH_REQUIREMENTS = {\n    \"/social\": {\n        limitKey: \"maxSocialConnections\",\n        minRequired: 1\n    },\n    \"/settings/integrations\": {\n        limitKey: \"maxPlatformIntegrations\",\n        minRequired: 1\n    },\n    \"/settings/platforms\": {\n        limitKey: \"maxPlatformIntegrations\",\n        minRequired: 1\n    },\n    \"/analytics/google\": {\n        limitKey: \"googleAnalytics\",\n        minRequired: true\n    },\n    \"/experiments\": {\n        limitKey: \"abTesting\",\n        minRequired: true\n    },\n    \"/heatmaps\": {\n        limitKey: \"maxHeatmaps\",\n        minRequired: 1\n    },\n    \"/recommendations\": {\n        limitKey: \"recommendationWidgets\",\n        minRequired: true\n    },\n    \"/reports\": {\n        limitKey: \"maxReports\",\n        minRequired: true\n    },\n    \"/support/support-tickets\": {\n        limitKey: \"supportTickets\",\n        minRequired: true\n    }\n};\nconst getAdminSecret = ()=>{\n    const secret = process.env.JWT_ADMIN_SECRET;\n    if (!secret) throw new Error(\"JWT_ADMIN_SECRET is not set.\");\n    return new TextEncoder().encode(secret);\n};\n// ==============================================================\n// 1. ORIGINAL MIDDLEWARE LOGIC (Renamed)\n// ==============================================================\nasync function customMiddleware(req) {\n    const { pathname } = req.nextUrl;\n    const appUrl = process.env.NEXTAUTH_URL || req.nextUrl.origin;\n    // NOTE: Public path check is now handled in 'authorized' callback below,\n    // but redundant check here is harmless and safe.\n    // ==============================================================\n    // 2. Admin Check\n    // ==============================================================\n    if (pathname.startsWith(\"/admin\") && !pathname.startsWith(\"/admin/login\")) {\n        const adminCookie = req.cookies.get(\"cortex-tracker-token\");\n        if (!adminCookie) return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(new URL(\"/admin/login\", appUrl));\n        try {\n            const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_4__.jwtVerify)(adminCookie.value, getAdminSecret());\n            if (payload.role !== \"superadmin\") throw new Error(\"Not superadmin\");\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.next();\n        } catch (e) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(new URL(\"/admin/login?error=InvalidToken\", appUrl));\n        }\n    }\n    // ==============================================================\n    // 3. Feature & Authentication Check\n    // ==============================================================\n    const requirement = Object.entries(PATH_REQUIREMENTS).find(([path])=>pathname.startsWith(path))?.[1];\n    if (requirement) {\n        // We can reuse the token from NextAuth wrapper if we wanted, but existing logic fetches it.\n        // req.nextauth.token is available if we used 'callbacks' correctly above.\n        // Let's stick to existing getToken to minimize breakage risk during migration.\n        const sessionToken = await (0,next_auth_jwt__WEBPACK_IMPORTED_MODULE_2__.getToken)({\n            req,\n            secret: process.env.NEXTAUTH_SECRET\n        });\n        // If user is not logged in, redirect to login\n        if (!sessionToken?.email) {\n            const loginUrl = new URL(\"/login\", appUrl);\n            loginUrl.searchParams.set(\"callbackUrl\", req.url);\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(loginUrl);\n        }\n        const priceId = sessionToken.stripePriceId;\n        const status = sessionToken.stripeSubscriptionStatus;\n        const isActive = status === \"active\" || status === \"trialing\";\n        let plan;\n        if (priceId && isActive) {\n            plan = (0,_lib_plans__WEBPACK_IMPORTED_MODULE_3__.getPlanDetails)(priceId);\n        } else {\n            plan = (0,_lib_plans__WEBPACK_IMPORTED_MODULE_3__.getPlanDetails)(null);\n        }\n        const limit = plan.limits[requirement.limitKey];\n        let hasAccess = false;\n        if (typeof requirement.minRequired === \"boolean\") {\n            const isTruthy = !!limit || limit === Number.POSITIVE_INFINITY;\n            hasAccess = isTruthy === requirement.minRequired;\n        } else if (typeof limit === \"number\") {\n            hasAccess = limit >= requirement.minRequired;\n        }\n        if (!hasAccess) {\n            const url = new URL(\"/upgrade-plans\", appUrl);\n            url.searchParams.set(\"reason\", isActive ? \"limit\" : \"inactive_or_free\");\n            url.searchParams.set(\"feature\", requirement.limitKey);\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(url);\n        }\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.next();\n}\n// ==============================================================\n// 4. MAIN EXPORT: WITHAUTH WRAPPER\n// ==============================================================\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_auth_middleware__WEBPACK_IMPORTED_MODULE_0__.withAuth)(customMiddleware, {\n    callbacks: {\n        authorized: ({ req, token })=>{\n            const { pathname } = req.nextUrl;\n            // A. PUBLIC PATHS - Allow\n            const publicPaths = [\n                \"/login\",\n                \"/registration\",\n                \"/verify-email\",\n                \"/api/auth\",\n                \"/api/register\",\n                \"/api/verify-token\",\n                \"/favicon.ico\",\n                \"/_next\",\n                \"/static\",\n                \"/api/webhooks\",\n                \"/api/crm/send-message\",\n                \"/api/webhooks/whatsapp\"\n            ];\n            if (publicPaths.some((path)=>pathname.startsWith(path))) {\n                return true;\n            }\n            // B. ADMIN PATHS - Allow (Let inner middleware handle custom token check)\n            if (pathname.startsWith(\"/admin\")) {\n                return true;\n            }\n            // C. DEFAULT - Require Session Token\n            // If token exists, return true (allow access -> run middleware).\n            // If false, redirects to pages.signIn\n            return !!token;\n        }\n    },\n    pages: {\n        signIn: \"/login\"\n    }\n}));\n// ==============================================================\n// 5. CONFIGURATION\n// ==============================================================\nconst config = {\n    matcher: [\n        \"/dashboard/:path*\",\n        \"/((?!api|_next/static|_next/image|favicon.ico|.*\\\\.webp$|.*\\\\.png$|.*\\\\.jpg$).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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MEI7WUFDMUIsTUFBTTBDLGNBQWM7Z0JBQ2hCO2dCQUNBO2dCQUNBO2dCQUNBO2dCQUNBO2dCQUNBO2dCQUNBO2dCQUNBO2dCQUNBO2dCQUNBO2dCQUNBO2dCQUNBO2FBQ0g7WUFDRCxJQUFJQSxZQUFZQyxJQUFJLENBQUN4QixDQUFBQSxPQUFRcEIsU0FBU0ssVUFBVSxDQUFDZSxRQUFRO2dCQUNyRCxPQUFPO1lBQ1g7WUFFQSwwRUFBMEU7WUFDMUUsSUFBSXBCLFNBQVNLLFVBQVUsQ0FBQyxXQUFXO2dCQUMvQixPQUFPO1lBQ1g7WUFFQSxxQ0FBcUM7WUFDckMsaUVBQWlFO1lBQ2pFLHNDQUFzQztZQUN0QyxPQUFPLENBQUMsQ0FBQ3FDO1FBQ2I7SUFDSjtJQUNBRyxPQUFPO1FBQ0hDLFFBQVE7SUFDWjtBQUNKLElBQ0Y7QUFFRixpRUFBaUU7QUFDakUsbUJBQW1CO0FBQ25CLGlFQUFpRTtBQUMxRCxNQUFNQyxTQUFTO0lBQ2xCQyxTQUFTO1FBQ0w7UUFDQTtLQUNIO0FBQ0wsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9zcmMvbWlkZGxld2FyZS5qcz9hNDlhIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9taWRkbGV3YXJlLmpzXG5leHBvcnQgY29uc3QgcnVudGltZSA9ICdub2RlanMnO1xuXG5pbXBvcnQgeyB3aXRoQXV0aCB9IGZyb20gXCJuZXh0LWF1dGgvbWlkZGxld2FyZVwiO1xuaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICduZXh0LWF1dGgvand0JztcbmltcG9ydCB7IGp3dFZlcmlmeSB9IGZyb20gJ2pvc2UnO1xuaW1wb3J0IHsgZ2V0UGxhbkRldGFpbHMgfSBmcm9tICdAL2xpYi9wbGFucyc7XG5cbi8vIC0tLSBGZWF0dXJlIE1hcHBpbmdzIC0tLVxuY29uc3QgUEFUSF9SRVFVSVJFTUVOVFMgPSB7XG4gICAgJy9zb2NpYWwnOiB7IGxpbWl0S2V5OiAnbWF4U29jaWFsQ29ubmVjdGlvbnMnLCBtaW5SZXF1aXJlZDogMSB9LFxuICAgICcvc2V0dGluZ3MvaW50ZWdyYXRpb25zJzogeyBsaW1pdEtleTogJ21heFBsYXRmb3JtSW50ZWdyYXRpb25zJywgbWluUmVxdWlyZWQ6IDEgfSxcbiAgICAnL3NldHRpbmdzL3BsYXRmb3Jtcyc6IHsgbGltaXRLZXk6ICdtYXhQbGF0Zm9ybUludGVncmF0aW9ucycsIG1pblJlcXVpcmVkOiAxIH0sXG4gICAgJy9hbmFseXRpY3MvZ29vZ2xlJzogeyBsaW1pdEtleTogJ2dvb2dsZUFuYWx5dGljcycsIG1pblJlcXVpcmVkOiB0cnVlIH0sXG4gICAgJy9leHBlcmltZW50cyc6IHsgbGltaXRLZXk6ICdhYlRlc3RpbmcnLCBtaW5SZXF1aXJlZDogdHJ1ZSB9LFxuICAgICcvaGVhdG1hcHMnOiB7IGxpbWl0S2V5OiAnbWF4SGVhdG1hcHMnLCBtaW5SZXF1aXJlZDogMSB9LFxuICAgICcvcmVjb21tZW5kYXRpb25zJzogeyBsaW1pdEtleTogJ3JlY29tbWVuZGF0aW9uV2lkZ2V0cycsIG1pblJlcXVpcmVkOiB0cnVlIH0sXG4gICAgJy9yZXBvcnRzJzogeyBsaW1pdEtleTogJ21heFJlcG9ydHMnLCBtaW5SZXF1aXJlZDogdHJ1ZSB9LFxuICAgICcvc3VwcG9ydC9zdXBwb3J0LXRpY2tldHMnOiB7IGxpbWl0S2V5OiAnc3VwcG9ydFRpY2tldHMnLCBtaW5SZXF1aXJlZDogdHJ1ZSB9LFxufTtcblxuY29uc3QgZ2V0QWRtaW5TZWNyZXQgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2VjcmV0ID0gcHJvY2Vzcy5lbnYuSldUX0FETUlOX1NFQ1JFVDtcbiAgICBpZiAoIXNlY3JldCkgdGhyb3cgbmV3IEVycm9yKFwiSldUX0FETUlOX1NFQ1JFVCBpcyBub3Qgc2V0LlwiKTtcbiAgICByZXR1cm4gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKHNlY3JldCk7XG59O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gMS4gT1JJR0lOQUwgTUlERExFV0FSRSBMT0dJQyAoUmVuYW1lZClcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5hc3luYyBmdW5jdGlvbiBjdXN0b21NaWRkbGV3YXJlKHJlcSkge1xuICAgIGNvbnN0IHsgcGF0aG5hbWUgfSA9IHJlcS5uZXh0VXJsO1xuICAgIGNvbnN0IGFwcFVybCA9IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1VSTCB8fCByZXEubmV4dFVybC5vcmlnaW47XG5cbiAgICAvLyBOT1RFOiBQdWJsaWMgcGF0aCBjaGVjayBpcyBub3cgaGFuZGxlZCBpbiAnYXV0aG9yaXplZCcgY2FsbGJhY2sgYmVsb3csXG4gICAgLy8gYnV0IHJlZHVuZGFudCBjaGVjayBoZXJlIGlzIGhhcm1sZXNzIGFuZCBzYWZlLlxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyAyLiBBZG1pbiBDaGVja1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hZG1pbicpICYmICFwYXRobmFtZS5zdGFydHNXaXRoKCcvYWRtaW4vbG9naW4nKSkge1xuICAgICAgICBjb25zdCBhZG1pbkNvb2tpZSA9IHJlcS5jb29raWVzLmdldCgnY29ydGV4LXRyYWNrZXItdG9rZW4nKTtcbiAgICAgICAgaWYgKCFhZG1pbkNvb2tpZSkgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvYWRtaW4vbG9naW4nLCBhcHBVcmwpKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGF5bG9hZCB9ID0gYXdhaXQgand0VmVyaWZ5KGFkbWluQ29va2llLnZhbHVlLCBnZXRBZG1pblNlY3JldCgpKTtcbiAgICAgICAgICAgIGlmIChwYXlsb2FkLnJvbGUgIT09ICdzdXBlcmFkbWluJykgdGhyb3cgbmV3IEVycm9yKCdOb3Qgc3VwZXJhZG1pbicpO1xuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL2FkbWluL2xvZ2luP2Vycm9yPUludmFsaWRUb2tlbicsIGFwcFVybCkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyAzLiBGZWF0dXJlICYgQXV0aGVudGljYXRpb24gQ2hlY2tcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIGNvbnN0IHJlcXVpcmVtZW50ID0gT2JqZWN0LmVudHJpZXMoUEFUSF9SRVFVSVJFTUVOVFMpLmZpbmQoKFtwYXRoXSkgPT4gcGF0aG5hbWUuc3RhcnRzV2l0aChwYXRoKSk/LlsxXTtcblxuICAgIGlmIChyZXF1aXJlbWVudCkge1xuICAgICAgICAvLyBXZSBjYW4gcmV1c2UgdGhlIHRva2VuIGZyb20gTmV4dEF1dGggd3JhcHBlciBpZiB3ZSB3YW50ZWQsIGJ1dCBleGlzdGluZyBsb2dpYyBmZXRjaGVzIGl0LlxuICAgICAgICAvLyByZXEubmV4dGF1dGgudG9rZW4gaXMgYXZhaWxhYmxlIGlmIHdlIHVzZWQgJ2NhbGxiYWNrcycgY29ycmVjdGx5IGFib3ZlLlxuICAgICAgICAvLyBMZXQncyBzdGljayB0byBleGlzdGluZyBnZXRUb2tlbiB0byBtaW5pbWl6ZSBicmVha2FnZSByaXNrIGR1cmluZyBtaWdyYXRpb24uXG4gICAgICAgIGNvbnN0IHNlc3Npb25Ub2tlbiA9IGF3YWl0IGdldFRva2VuKHsgcmVxLCBzZWNyZXQ6IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1NFQ1JFVCB9KTtcblxuICAgICAgICAvLyBJZiB1c2VyIGlzIG5vdCBsb2dnZWQgaW4sIHJlZGlyZWN0IHRvIGxvZ2luXG4gICAgICAgIGlmICghc2Vzc2lvblRva2VuPy5lbWFpbCkge1xuICAgICAgICAgICAgY29uc3QgbG9naW5VcmwgPSBuZXcgVVJMKCcvbG9naW4nLCBhcHBVcmwpO1xuICAgICAgICAgICAgbG9naW5Vcmwuc2VhcmNoUGFyYW1zLnNldCgnY2FsbGJhY2tVcmwnLCByZXEudXJsKTtcbiAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobG9naW5VcmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcHJpY2VJZCA9IHNlc3Npb25Ub2tlbi5zdHJpcGVQcmljZUlkO1xuICAgICAgICBjb25zdCBzdGF0dXMgPSBzZXNzaW9uVG9rZW4uc3RyaXBlU3Vic2NyaXB0aW9uU3RhdHVzO1xuICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IHN0YXR1cyA9PT0gJ2FjdGl2ZScgfHwgc3RhdHVzID09PSAndHJpYWxpbmcnO1xuXG4gICAgICAgIGxldCBwbGFuO1xuICAgICAgICBpZiAocHJpY2VJZCAmJiBpc0FjdGl2ZSkge1xuICAgICAgICAgICAgcGxhbiA9IGdldFBsYW5EZXRhaWxzKHByaWNlSWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGxhbiA9IGdldFBsYW5EZXRhaWxzKG51bGwpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbGltaXQgPSBwbGFuLmxpbWl0c1tyZXF1aXJlbWVudC5saW1pdEtleV07XG4gICAgICAgIGxldCBoYXNBY2Nlc3MgPSBmYWxzZTtcblxuICAgICAgICBpZiAodHlwZW9mIHJlcXVpcmVtZW50Lm1pblJlcXVpcmVkID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIGNvbnN0IGlzVHJ1dGh5ID0gISFsaW1pdCB8fCBsaW1pdCA9PT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZO1xuICAgICAgICAgICAgaGFzQWNjZXNzID0gaXNUcnV0aHkgPT09IHJlcXVpcmVtZW50Lm1pblJlcXVpcmVkO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBsaW1pdCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGhhc0FjY2VzcyA9IGxpbWl0ID49IHJlcXVpcmVtZW50Lm1pblJlcXVpcmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFoYXNBY2Nlc3MpIHtcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoJy91cGdyYWRlLXBsYW5zJywgYXBwVXJsKTtcbiAgICAgICAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCdyZWFzb24nLCBpc0FjdGl2ZSA/ICdsaW1pdCcgOiAnaW5hY3RpdmVfb3JfZnJlZScpO1xuICAgICAgICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ2ZlYXR1cmUnLCByZXF1aXJlbWVudC5saW1pdEtleSk7XG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KHVybCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIDQuIE1BSU4gRVhQT1JUOiBXSVRIQVVUSCBXUkFQUEVSXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuZXhwb3J0IGRlZmF1bHQgd2l0aEF1dGgoXG4gICAgY3VzdG9tTWlkZGxld2FyZSxcbiAgICB7XG4gICAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAgICAgYXV0aG9yaXplZDogKHsgcmVxLCB0b2tlbiB9KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXRobmFtZSB9ID0gcmVxLm5leHRVcmw7XG5cbiAgICAgICAgICAgICAgICAvLyBBLiBQVUJMSUMgUEFUSFMgLSBBbGxvd1xuICAgICAgICAgICAgICAgIGNvbnN0IHB1YmxpY1BhdGhzID0gW1xuICAgICAgICAgICAgICAgICAgICAnL2xvZ2luJyxcbiAgICAgICAgICAgICAgICAgICAgJy9yZWdpc3RyYXRpb24nLFxuICAgICAgICAgICAgICAgICAgICAnL3ZlcmlmeS1lbWFpbCcsXG4gICAgICAgICAgICAgICAgICAgICcvYXBpL2F1dGgnLFxuICAgICAgICAgICAgICAgICAgICAnL2FwaS9yZWdpc3RlcicsXG4gICAgICAgICAgICAgICAgICAgICcvYXBpL3ZlcmlmeS10b2tlbicsXG4gICAgICAgICAgICAgICAgICAgICcvZmF2aWNvbi5pY28nLFxuICAgICAgICAgICAgICAgICAgICAnL19uZXh0JyxcbiAgICAgICAgICAgICAgICAgICAgJy9zdGF0aWMnLFxuICAgICAgICAgICAgICAgICAgICAnL2FwaS93ZWJob29rcycsXG4gICAgICAgICAgICAgICAgICAgICcvYXBpL2NybS9zZW5kLW1lc3NhZ2UnLFxuICAgICAgICAgICAgICAgICAgICAnL2FwaS93ZWJob29rcy93aGF0c2FwcCdcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgIGlmIChwdWJsaWNQYXRocy5zb21lKHBhdGggPT4gcGF0aG5hbWUuc3RhcnRzV2l0aChwYXRoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQi4gQURNSU4gUEFUSFMgLSBBbGxvdyAoTGV0IGlubmVyIG1pZGRsZXdhcmUgaGFuZGxlIGN1c3RvbSB0b2tlbiBjaGVjaylcbiAgICAgICAgICAgICAgICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FkbWluJykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQy4gREVGQVVMVCAtIFJlcXVpcmUgU2Vzc2lvbiBUb2tlblxuICAgICAgICAgICAgICAgIC8vIElmIHRva2VuIGV4aXN0cywgcmV0dXJuIHRydWUgKGFsbG93IGFjY2VzcyAtPiBydW4gbWlkZGxld2FyZSkuXG4gICAgICAgICAgICAgICAgLy8gSWYgZmFsc2UsIHJlZGlyZWN0cyB0byBwYWdlcy5zaWduSW5cbiAgICAgICAgICAgICAgICByZXR1cm4gISF0b2tlbjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHBhZ2VzOiB7XG4gICAgICAgICAgICBzaWduSW46ICcvbG9naW4nLFxuICAgICAgICB9LFxuICAgIH1cbik7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA1LiBDT05GSUdVUkFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgICBtYXRjaGVyOiBbXG4gICAgICAgIFwiL2Rhc2hib2FyZC86cGF0aCpcIixcbiAgICAgICAgXCIvKCg/IWFwaXxfbmV4dC9zdGF0aWN8X25leHQvaW1hZ2V8ZmF2aWNvbi5pY298LipcXFxcLndlYnAkfC4qXFxcXC5wbmckfC4qXFxcXC5qcGckKS4qKVwiXG4gICAgXSxcbn07XG4iXSwibmFtZXMiOlsicnVudGltZSIsIndpdGhBdXRoIiwiTmV4dFJlc3BvbnNlIiwiZ2V0VG9rZW4iLCJqd3RWZXJpZnkiLCJnZXRQbGFuRGV0YWlscyIsIlBBVEhfUkVRVUlSRU1FTlRTIiwibGltaXRLZXkiLCJtaW5SZXF1aXJlZCIsImdldEFkbWluU2VjcmV0Iiwic2VjcmV0IiwicHJvY2VzcyIsImVudiIsIkpXVF9BRE1JTl9TRUNSRVQiLCJFcnJvciIsIlRleHRFbmNvZGVyIiwiZW5jb2RlIiwiY3VzdG9tTWlkZGxld2FyZSIsInJlcSIsInBhdGhuYW1lIiwibmV4dFVybCIsImFwcFVybCIsIk5FWFRBVVRIX1VSTCIsIm9yaWdpbiIsInN0YXJ0c1dpdGgiLCJhZG1pbkNvb2tpZSIsImNvb2tpZXMiLCJnZXQiLCJyZWRpcmVjdCIsIlVSTCIsInBheWxvYWQiLCJ2YWx1ZSIsInJvbGUiLCJuZXh0IiwiZSIsInJlcXVpcmVtZW50IiwiT2JqZWN0IiwiZW50cmllcyIsImZpbmQiLCJwYXRoIiwic2Vzc2lvblRva2VuIiwiTkVYVEFVVEhfU0VDUkVUIiwiZW1haWwiLCJsb2dpblVybCIsInNlYXJjaFBhcmFtcyIsInNldCIsInVybCIsInByaWNlSWQiLCJzdHJpcGVQcmljZUlkIiwic3RhdHVzIiwic3RyaXBlU3Vic2NyaXB0aW9uU3RhdHVzIiwiaXNBY3RpdmUiLCJwbGFuIiwibGltaXQiLCJsaW1pdHMiLCJoYXNBY2Nlc3MiLCJpc1RydXRoeSIsIk51bWJlciIsIlBPU0lUSVZFX0lORklOSVRZIiwiY2FsbGJhY2tzIiwiYXV0aG9yaXplZCIsInRva2VuIiwicHVibGljUGF0aHMiLCJzb21lIiwicGFnZXMiLCJzaWduSW4iLCJjb25maWciLCJtYXRjaGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.js\n");

/***/ })

});